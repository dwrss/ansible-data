---

- hosts: docker_hosts
  tasks:
    - name: start volatile containers
      docker_container:
        name: "{{ item }}"
        hostname: "{{ item }}"
        image: "{{ hostvars[item].docker_containers_image }}"
        pull: yes
        command: "{{ hostvars[item].docker_containers_command | default('tail -f /dev/null') }}"
        state: started
        recreate: "{{ hostvars[item].docker_containers_recreate | default('no') }}"
      with_inventory_hostnames: docker_containers
      when: hostvars[item].docker_containers_volatile | default('no') | bool

- hosts: docker_containers
  gather_facts: no
  pre_tasks:
    - name: raw config
      raw: "{{ docker_containers_raw }}"
      when: docker_containers_raw is defined

    - name: gather facts
      setup: {}

