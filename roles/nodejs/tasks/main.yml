---
- block:
    - name: get node setup script
      get_url:
          url: https://deb.nodesource.com/setup_{{ node_version }}.x
          dest: ~/node_setup_{{ node_version }}.x.bash

    - name: execute node setup script
      shell: bash ~/node_setup_{{ node_version }}.x.bash

    - name: install nodejs apt
      apt: name=nodejs state=latest update_cache=yes
      when: ansible_pkg_mgr == 'apt'
    
    - name: install nodejs yum
      yum: name=nodejs state=latest update_cache=yes
      when: ansible_pkg_mgr == 'yum'

    - name: install nodejs homebrew
      homebrew: name=node state=latest update_homebrew=yes
      when: ansible_pkg_mgr == 'homebrew'

    - name: update npm
      npm: name=npm state=latest global=yes

  always:
    - name: remove node setup script
      file: path=~/node_setup_{{ node_version }}.x.bash state=absent


